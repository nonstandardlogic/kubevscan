apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: "tumblr-sidecar-injector-webhook"
  labels:
    app: {{ .Values.appName }}
    track: {{ .Values.track }}
webhooks:
- name: "injector.tumblr.com"
  failurePolicy: "Ignore" # we fail "open" if the webhook is down hard
  rules:
  - operations: [ "CREATE" ]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  clientConfig:
    # https://github.com/kubernetes/kubernetes/blob/v1.10.0-beta.1/staging/src/k8s.io/api/admissionregistration/v1beta1/types.go#L218
    # note: k8s is smart enough to use 443 or the only exposed port on the service
    # note: this requires the service to serve TLS directly (not thru ingress)
    service:
      name: "{{ .Values.appName }}-{{ .Values.track }}"
      namespace: "{{ .Values.namespace }}"
      path: "/mutate"   # what /url/slug to send requests at
    # See README.md for how this was generated!
    caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZ5VENDQTdFQ0ZEeTQ4VmlyMGZWUkY5cXZRMy9uaVF0MC92R0ZNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1JR2YKTVFzd0NRWURWUVFHRXdKVlV6RVJNQThHQTFVRUNBd0lUbVYzSUZsdmNtc3hGakFVQmdOVkJBY01EVTVsZHlCWgpiM0pySUVOcGRIa3hHVEFYQmdOVkJBb01FRzV2Ym5OMFlXNWtZWEprYkc5bmFXTXhJREFlQmdOVkJBTU1GMnM0CmN5MXphV1JsWTJGeUxXbHVhbVZqZEc5eUxVTkJNU2d3SmdZSktvWklodmNOQVFrQkZobHVkV3hzUUc1dmJuTjAKWVc1a1lYSmtiRzluYVdNdVkyOXRNQ0FYRFRJd01UQXlOakU1TkRneE1Gb1lEelEzTlRnd09USXlNVGswT0RFdwpXakNCbnpFTE1Ba0dBMVVFQmhNQ1ZWTXhFVEFQQmdOVkJBZ01DRTVsZHlCWmIzSnJNUll3RkFZRFZRUUhEQTFPClpYY2dXVzl5YXlCRGFYUjVNUmt3RndZRFZRUUtEQkJ1YjI1emRHRnVaR0Z5Wkd4dloybGpNU0F3SGdZRFZRUUQKREJkck9ITXRjMmxrWldOaGNpMXBibXBsWTNSdmNpMURRVEVvTUNZR0NTcUdTSWIzRFFFSkFSWVpiblZzYkVCdQpiMjV6ZEdGdVpHRnlaR3h2WjJsakxtTnZiVENDQWlJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dJUEFEQ0NBZ29DCmdnSUJBS2ZNUUNPejRqRWlhMFkvclNxZWNsUWh4b1FmYUE4WVBNTGtwVDA4Y3YzZEsxK2I2VElBRGxlVXQ2K04KdFRUN3lLcHFhZ1E3aUtCdG9RYnBUV2Y2UnRNcURSWWJ3SjJmd21MSUNBbWhoZmZSWVcwZnBjL0JOdlZnQkdsbQovcXZRMjlmaGwweXJOWjhzcC80Y0VyVGpXQW02bzVxanUzWm1YTUlVMlRNMTNITnNySmhDTVh0cjdnOHpTWlQxCkJDMWMzTG5LNWRuemtnRmRBMkZLREQ0eGhtVzJxQk1nZVZqeFd2RFdKK1BwQ0FoWEowT0JPMU1xcWlZRjB3dngKWG9yZkNPaXdPOUc5WHVGM3RUeHdmK2tXamdYdEtOZnV5eEsyMGsyL0crdjEwdUliUGl5N0xWdVoxdEhNSzNVOQo3UGNQdU1Rck5oTUk4TEhHZlcyOGIxeG9LejhRQ1dvUEtBTTFCOEovSytsL0dyUFNXTlpoZEdETkVzSUhVdDN1CjZvcDdWRldaeHVELzRMOENINHYrcFM1QTBNcU41akgwejZDQ2xWWVpHRHZJTmNxWmNpZUIrWUFkSUtZNUVVR1QKM3FBaTNTeGpZU3I3ZjRiQUU4NjhiaUM4eld5QkJCODErR3krR1g4K0g5OGdPMDNrWnhvNFUvSG5vVEVqWitrYQp4cTA3UXdReTEvZVFvRnljRUkzYXgwdjZIR0szMG5qQ01wSExTajM4UnZ0cFI5MjZBR3ZMbmg1bHFseHcxZXBMCmdvTjRyTmFXMHZxSmlzTHlNVmJqcGk3bXA1N2ZUMy9KWExvczFMdWdDZTV1TlN4YkF3K3lHYlo0V0hSVkNoSGUKVEQxSDk2SHlmT3lmUEhFRndSbGtnb2hRSXQ0bnFEa1ZUTWR5OXpaVE5BbHRBZTJYQWdNQkFBRXdEUVlKS29aSQpodmNOQVFFTEJRQURnZ0lCQURjNjVrMVZydEQrUmw2eUhMVEFsaXlsYkE4aFh3eHJVQ1NicTJRUC9hOURld3JCCktxYnREYXp2aDgzam1iMUlJc1NOOU1jREVEejIydHJzZHBRdTBKOU0yNmZPdUY1dENqVTM5b21SOGJULzdGcE4KVnFNY2RxKytId0o0bTVCSFY0VVBKUTB1REJxLzFUS1I2MlFMVTl6bjRTVnpWZnAyQmIzaEdSMCtCK2owQzJYNgpGTFViSlljNkwyZ0lkWFA3K0JTdmlJQ3M5RzRmWFgwQVMwL2ZzYlIrOGk0SDBCWEdBeUNncGpKSmZCYW9lRys0CldRMVNBd3hJUnZxbFNJeExpbjloUTJNeUFLcDB0UXdDNHVJVk16alBDSnZQWHJHM3VoRVN1N29oUXRxdk51Y3IKWmlkaGQyU3phOVNUT1ZqeHVHa2oxcHNoSFpObThvVjZXUnZtVi9CTytaTlI1ZjJTOVVlUEd3QzRZT29aYVR4dwpxKzJsMCtEZGtJT0VyUXpJRk9DNCsrY3F5QWhORHNvbFhSdmNyN3VYNXY1M1l0WXJMVlpaYjdpS2xsU1B6NFBqCmpWRnNiT1BjTWFhaFhWWS91bC8vRnMweW5SaHRqTzZldCtQS20yQ0VFL25qb0RhSkJvTmdZRHlWOWZPdU5VU1UKQlFEeURYUisyOGJYZVN0MEprUnZwTVQ4VGlHaDF4Zy9HTkpTV2huQmVoQUNNSTZZdkhZVEpoTkZ6N0JBcEJHTgpINFk5S3h0d1hDL3prSmlrYmpDaTZxODRLOGoybW9LdVFoRWNDK1JXNEhRT0JmV3UvUGhtREZUSENmcHhhSDFHCjlZU0NZS2J5Um0xSGY2Rjlqa2QxeExrdy9OZjJRaHpEM2RERTZsSG5SbHMyZStqdm85TmpvbFduVjRjVQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="

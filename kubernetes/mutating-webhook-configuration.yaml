apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
  name: "tumblr-sidecar-injector-webhook"
  labels:
    app: k8s-sidecar-injector
    track: prod
webhooks:
- name: "injector.tumblr.com"
  failurePolicy: "Ignore" # we fail "open" if the webhook is down hard
  rules:
  - operations: [ "CREATE" ]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  clientConfig:
    # https://github.com/kubernetes/kubernetes/blob/v1.10.0-beta.1/staging/src/k8s.io/api/admissionregistration/v1beta1/types.go#L218
    # note: k8s is smart enough to use 443 or the only exposed port on the service
    # note: this requires the service to serve TLS directly (not thru ingress)
    service:
      name: "k8s-sidecar-injector-prod"
      namespace: "kube-system"
      path: "/mutate"   # what /url/slug to send requests at
    # See README.md for how this was generated!
    caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZ1ekNDQTZNQ0ZGOUMxZFJaK0xmZFk4LzFuRHpJQWxwZk1TSmNNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1JR1kKTVFzd0NRWURWUVFHRXdKSFFqRVBNQTBHQTFVRUNBd0dURzl1Wkc5dU1ROHdEUVlEVlFRSERBWk1iMjVrYjI0eApHVEFYQmdOVkJBb01FRzV2Ym5OMFlXNWtZWEprYkc5bmFXTXhJREFlQmdOVkJBTU1GMnM0Y3kxemFXUmxZMkZ5CkxXbHVhbVZqZEc5eUxVTkJNU293S0FZSktvWklodmNOQVFrQkZodHpaWEpuWlcxQWJtOXVjM1JoYm1SaGNtUnMKYjJkcFl5NWpiMjB3SUJjTk1qQXhNREUxTVRFeU9EVTJXaGdQTkRjMU9EQTVNVEV4TVRJNE5UWmFNSUdZTVFzdwpDUVlEVlFRR0V3SkhRakVQTUEwR0ExVUVDQXdHVEc5dVpHOXVNUTh3RFFZRFZRUUhEQVpNYjI1a2IyNHhHVEFYCkJnTlZCQW9NRUc1dmJuTjBZVzVrWVhKa2JHOW5hV014SURBZUJnTlZCQU1NRjJzNGN5MXphV1JsWTJGeUxXbHUKYW1WamRHOXlMVU5CTVNvd0tBWUpLb1pJaHZjTkFRa0JGaHR6WlhKblpXMUFibTl1YzNSaGJtUmhjbVJzYjJkcApZeTVqYjIwd2dnSWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUUNzaDljczAyaGJlRHNPCkpYcUE1OVc0QVYvZ0Zkak5CNCtkQzg0SzVrTXQyTnh6UzVuV1FXOXMyWEc3Zm10bGpFUFVFRnBDV0RuaW40OHIKWFZWKzg2NTNoZTgvV1hlekdVUEFwVDdvOXBTZVViZzFkdXJ1RFRrTE13V29xZTlSZ2ZWaS91RlF1QWNOekE2cApZZU9MSEpiZEJveFpTOTIwV25oQ2RRalJOMFJtd2ZaaTNoYU9FWU1wR3NHdVk0L21qYktvQVRYbG8xbGswWENjCmR5cnVDMTNlNm8wKzVDQlNZRUMxNlF0am1YUk4xd24vOWxvMG51bm9LL1pER2wvc3pVL2NVQktLcXQ2VEpDaWkKR1Z0WFZ2Y3M5THVBeGtROVFPT2I3a1hLd3M5TVd1MGRHcm1Nb0ZZYjlTNzFSTGpRazVLWkdoWlh1Zk1LcmtYRwpSWTBqWnk1OWhFS3JHUGZGbnlQRVQ2UTRBTGdLc00rT295SmJscnRBZDdPaE9TRFc2SDdZNi9jUnBkdU0xTzBzCjF0M1lSbXRDcTVKSEtFSkF0VWh1SDY3eEFNKzhiVy9MUTUzZE80SHd2WFExbC8yRlRGL3YzemZWdzBSWWJHbjEKdWZ1eFNnTnU5NkljSUd3ZEJLdDZTcThNRFdYQVBtWXh2V3hmMjVDMG1lSjZJZmxmREQ1ZXJDd0VCRUl0VDY1RQpIcnRCa3ovQmFRY0hxR1JFLzcxYkxPTFJ5cFY0d2luTWVRcjRCbjZJd1hkQTZVS0hkdUpzL1JUejI2WXY4b2R2CjVvRU4vRFdBVjFQeEhOcFM1VWtKWXBXQ3hRcjJFWldHT3ArbEJBMzNIQ3VNeCtHalltSlBnZDlaVnpjcEU4SWIKZEFzRXJCVUs5bjlsUnBxdElXQm9RcjVJeFQxdWt3SURBUUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElDQVFBbApaV2R1UzREQXVUS0ExNTdneFU3TGFXWU5meWdRd0YrSFdma1RrdmRzcGZYK2RTT0xuOUdrTU0vZWVRVmNtdTBuCmwzcS91ejgxSEJZb00zL3hOVUM4ZEI5ZHcxL2RZb1d4bDc3a3VhNzFZbFVjRThJd2VvZVc0UUFwYUxGaVFKc3kKaUpubkxuNVJKNUpwYkVGZDNRMmhGc3g1NVBqWHQ5R2RXeXVxM2hrS210cmIweG45Y0piTU9UWUo4ME1NQVl4TQplaklrWXNrMHZpRUxVbzZrMnRvcFFkUkpTWVJvMGlMUjBkTFdNVEppdlpHVmY3aUd2SFh3QWdjZS9qSUtUSFFoCm9tK3ZFanQyR1VMSEowWWE1WnMzWmlnaXBTTGpqcGthM1I1MDA0MGVMUVpTSitLb0s0dURQYUdNM2gzZCtUTDYKMHJuVmsyN0g5dlFxZFJBeTlJY01CaDRFb1ROSGNYcmRsalpwUGRmWmRid1BlOEVyZ2ZCWDlvOCsrVlVVYTNBUQpMMFRTRm5wRldTcTdGTEF6V3JMSTR4MFBkeUFldlp1WVI2dmRzaHA4ZWpRT1VmOVBBOEJubTkxVk1RU2pGRzV4CkhvazlSaGZlMmloVzZZT3VmMTRzaFdpZGJibWFtdzlxRUliMkNHRXJiSldGd0Y3NWgvVmdwQkQxT2hkWWltb2gKZnRFbExkb3hqeldaaG5HbWhyTHk4RitBSmV4TlVzV05JWjVheHBRNy9kSDdoNjgwMWtFUmptV2pmWi9TelhRaApsOGJFbHJaSjdCVEtLTllmemk3dktCOGJNeStYeHRxNmdYQUdIQzc5aytvNWlwbi9qVTVWdFptUzRYOWtNN1RJCjh6bWtjSmROMWYzSjNwblZaM2ptMVJjZlZGUmNBeEw1ZXV6dUJFdE1ZUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
